# Getting started

## Install Meteor
Meteor runs best on OSX or Linux. 

> If you only have access to Windows, or just want to get going quickly, you can try out an online IDE at [Codebox](https://www.codebox.io/stack/meteor)

Run the following in a Unix-compatible shell:

    curl https://install.meteor.com/ | sh

Now if you run `meteor --version`, you should see no errors, but something like this:

    codio@formal-oasis:~/workspace$ meteor --version
    Meteor 0.9.1.1   

## Creating a project
From your `~/workspace/` dir, run the following in the terminal (you can choose another name if you'd like, of course):

    meteor create meteor-music-blog 
    cd meteor-music-blog 
    meteor

Now click the top right arrow dropdown, and select "Box URL". A new browser tab should open and, **BOOM!** - App. Hit ctrl-c in the terminal to kill it.

## Structure the project
Create separate `client/` and `server/` directories for our code to live in, so that the separation of concerns is evident:

    mkdir -p client/vendor
    mkdir server
    mv meteor-music-blog.* client/
    touch server/backend.js

Now there is a snippet of code at the bottom of the autogenerated "meteor-music-blog.js"-file that belongs on the server. Can you guess which one it is? Great, then move it to the new "backend.js"-file.


## Using a UI framework
Using meteor's package manager, install the [Bootstrap UI framework](http://getbootstrap.com/), to make this look cooler:

    meteor add ian:bootstrap-3


Re-run the app. Notice anything different?

### Make it look cool!
Go ahead and add a little more meat to the page. Find a bootstrap template you like [from the examples](http://getbootstrap.com/getting-started/#examples), and fetch the content (i.e. what's inside the \<body\> tag) from one of the templates, for example the one called [navbar-static-top](https://github.com/twbs/bootstrap/blob/master/docs/examples/navbar-static-top/) and put it into the \<body\> tag in `meteor-music-blog.html`, replacing whats already there.

Don't forget to copy the accompanying template CSS (if any) into your `meteor-music-blog.css`.

**Now run your app*. It should look good, and you should have a navbar, even a responsive one!

## Adding authentication
We want users to authenticate before using our app. Let's again leverage the fantastic Meteor ecosystem to really hit the ground running in this department:

    meteor add accounts-base accounts-password

Then lets install automatic Bootstrap login-component UI integration:

    meteor add ian:accounts-ui-bootstrap-3

Then add the following template snippet to your navbar (see instructions [here](https://atmospherejs.com/ian/accounts-ui-bootstrap-3))

    <ul class="nav navbar-nav navbar-right">
        {{> loginButtons }} <!-- here -->
    </ul>

Restart the app, and enjoy accounts integration! After signing up, type `Meteor.user()` in the console to see the user-object while logged in. You can now also use the built-in `{{currentUser}}` helper in templates.

**[See an example of what the code can look like at this point]()**

## Integrate with Soundcloud using Oauth
Let's integrate our app with [Soundcloud](). To do that, you need a Soundcloud account, and then go to (http://developers.soundcloud.com/) and click "Register new app".

Set up your app similar to this:
![Soundcloud app config](https://dl.dropboxusercontent.com/s/r3nxaoybxpbolyt/Screenshot%202014-06-10%2022.13.40.png)

If you're running it locally, the redirect URL should read `http://localhost:3000/_oauth/soundcloud?close` 

Then, install Soundcloud support for your meteor app:

    meteor add mrt:accounts-soundcloud
    meteor add service-configuration

Then configure the Service, in `backend.js`: 

    // first, remove configuration entry in case service is already configured
    ServiceConfiguration.configurations.remove({
      service: "soundcloud"
    });
    ServiceConfiguration.configurations.insert({
      service: "soundcloud",
      clientId: "<your soundcloud clientId here>",
      secret: "<your soundcloud app secret here>"
    });
    
Insert your app's `clientId` and `secret` accordingly, of course.

Now, add this template helper to your client-side JS file to leverage our newly added Soundcloud Oauth integration:

    Template._loginButtonsLoggedInDropdown.events({
        'click #soundcloud-login': function(event) {
            event.stopPropagation();
            Template._loginButtons.toggleDropdown();
            Meteor.loginWithSoundcloud(function(evt) {
                console.log("Logged in");
            });
        }
    });
    
Now see what `Meteor.user().services` gives you, and try to output something cool in the templates using the `{{currentUser.services.soundcloud}}` object!

**[See an example of what the code can look like at this point]()**


## Implement basic routing
Any webapp with more than ultra-basic functionality will need *routing*, i.e. navigation and the ability to associate a URL path with a page or view.

Many packages can give us this functionality, but one great alternative is [Iron.Router](https://github.com/EventedMind/iron-router):

    meteor add iron:router
    
Now, adding a new page can be as simple as this: 

1. Add a new route, f. ex.:

        Router.map(function() {
            this.route('myPage', {path: '/mypage'});
        });

2. Add a new template named `mypage`, with the contents of your page
3. Add a `{{> yield}}` block to your \<body\>, which is where your new template will appear.

It makes a little more sense to use *layouts* once you implement routing. Take a look at [the docs](http://eventedmind.github.io/iron-router/#layouts) for details on how to use layouts.

Implement a route and check that it works (your template is shown at the right URL).

**[See an example of what the code can look like at this point]()**


## Use the Soundcloud API
For the sake of saving time, create a new file, `soundcloud.js` in your `client/` dir and paste the following code:

    /* soundcloud.js */
    
    var dep = new Deps.Dependency;
    Soundcloud = {
      getLikes: function() {
        dep.depend();

        //Set access token so we can query the Soundcloud API
        var user = Meteor.user();
        if(user && user.services.soundcloud){
            var accessToken = user.services.soundcloud.accessToken;
            if(accessToken){
                console.log('setting access token');
                SC.accessToken(accessToken);
            }
        }
        
        if(typeof this.likes === 'undefined') {
          this.likes = [];

          //Call the API
          SC.get("/me/favorites", {limit: 10} ,_.bind(function(response){
            if(response.errors){
                //TODO: Handle error
            }
            this.likes = response;
            dep.changed();
          }, this));
        }
        return this.likes;
      }
    };
    
Now try using this in a template. You'll have to create a new helper like this one:

    Template.<template name>.likes = function() {
        return Soundcloud.getLikes();
    }
    
and you'll be able to access the fetched likes using a `{{#each likes}}` helper for example.

Resource: More about [spacebars template helpers](https://www.discovermeteor.com/blog/spacebars-secrets-exploring-meteor-new-templating-engine/).

**[See an example of what the code can look like at this point]()**

# Tasks
Here are some tasks for you..

## Import your "likes" to the Meteor database
Save the "likes" that are fetched from Soundcloud to the apps' database so that we can mold this data and present it as we wish. For this you'll have to create a Meteor [Collection](http://docs.meteor.com/#collections) and use it's `insert()` method.  

Helpful resource: [Databases Part 1](http://meteortips.com/book/databases-part-1/) chapter of the [Beggining Meteor](http://meteortips.com/book/) book.

## Create player widgets
Using the Soundcloud widget, you can easily add player widgets to your app. Hint: 

    <iframe width="300" height="300" scrolling="no" frameborder="no" src="https://w.soundcloud.com/player/?visual=true&url={{uri}}&show_artwork=true&show_comments=false&color=e7e7e7"></iframe>
    
Resources: [Soundcloud Widget API](https://developers.soundcloud.com/docs/api/html5-widget)

## Edit saved objects
Implement a way to edit tracks/objects that are already saved to the database.  
Resources:

* [Meteor#Collection.update()](http://docs.meteor.com/#update)
* [Databases pt.2](http://meteortips.com/book/databases-part-2/) chapter of the book
* [Forms](http://meteortips.com/book/forms/) chapter of the book

## Deploy your app to the internets
Its simple..

    meteor deploy myapp.meteor.com

But you'll have to create a new app in Soundcloud that corresponds to the deployed app's URL.

## Do something fun!
The [Soundcloud API](https://developers.soundcloud.com/docs/api/reference) provides lots of endpoints to play with. Use these endpoints to create something cool! 

